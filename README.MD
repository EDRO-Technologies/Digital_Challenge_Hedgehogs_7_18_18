## **ПрофсоюзПэй**

### Обзор
Проект реализует бота для управления членскими взносами и отправки напоминаний. Система включает Telegram-бота (`telebot`), веб-интерфейс (`Flask`) и интеграцию с платежной платформой YooKassa. Поддерживаются регистрация пользователей, отслеживание платежей и административные функции для управления взносами и участниками.

---

### Возможности
1. **Функционал Telegram-бота**:
   - Регистрация пользователей с вводом личных данных.
   - Напоминания и подтверждения платежей через YooKassa.
   - Команды для пользователей и администраторов:
     - `/start` — регистрация пользователя.
     - `/i_paid` — проверка статуса платежа.
     - `/who_paid` — команда для администраторов для просмотра статусов платежей.

2. **Веб-интерфейс**:
   - Просмотр статусов платежей для пользователей.
   - Административная панель для настройки взносов.
   - Страницы для завершения и подтверждения платежей.

3. **Автоматическое расписание**:
   - Регулярная отправка напоминаний о неоплаченных взносах с использованием библиотеки `schedule`.

4. **Управление базой данных**:
   - Хранение данных о пользователях, платежах и их статусах в SQLite.

5. **Безопасность**:
   - Шифрование конфиденциальной информации с помощью библиотеки `cryptography`.
   - Использование переменных окружения через `dotenv` для безопасного хранения ключей.

---

### Установка

#### Требования
- Python 3.8+
- SQLite
- Токен Telegram-бота
- Данные аккаунта YooKassa
- Файл окружения (`.env`) с настройками:
  ```
  TOKEN_BOT=<Токен_Telegram_бота>
  ACCOUNT_ID=<ID_аккаунта_YooKassa>
  SECRET_KEY=<Секретный_ключ_YooKassa>
  ENCRYPTION_KEY=<32-значный_ключ_шифрования>
  ```

#### Шаги установки
1. **Склонируйте репозиторий**:
   ```bash
   git clone <ссылка-на-репозиторий>
   cd <папка-проекта>
   ```

2. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Подготовьте базы данных**:
   - Создайте необходимые базы данных SQLite в папке `database/`:
     - `chats.db` для данных пользователей.
     - `payments.db` для отслеживания платежей.
   - Запустите миграции схемы базы данных, если это необходимо.

4. **Запустите бота и сервер**:
   - Запустите Telegram-бота:
     ```bash
     python main.py
     ```
   - Запустите веб-сервер Flask:
     ```bash
     python app.py
     ```

---

### Использование

#### Для пользователей
1. Начните работу с ботом, отправив команду `/start`, и завершите процесс регистрации.
2. Получите информацию о платеже и ссылку на оплату через бот.
3. Подтвердите оплату с помощью команды `/i_paid`.

#### Для администраторов
1. Перейдите на страницу `/admin` для создания нового взноса.
2. Используйте команду `/who_paid` для просмотра списка оплативших и неоплативших пользователей.

#### Напоминания о платежах
- Напоминания о неоплаченных взносах отправляются автоматически каждые три дня.

---

### Структура проекта
```
project/
│
├── main.py                  # Реализация Telegram-бота
├── app.py                   # Веб-сервер Flask
├── templates/               # HTML-шаблоны для веб-интерфейса
├── database/                # Файлы баз данных SQLite
├── .env                     # Переменные окружения
├── requirements.txt         # Зависимости Python
└── README.md                # Документация (этот файл)
```

---

### Основные библиотеки
- **telebot**: API Telegram-бота.
- **Flask**: Веб-фреймворк для интерфейса пользователей и администраторов.
- **cryptography**: Шифрование конфиденциальной информации.
- **sqlite3**: Легковесная база данных для управления пользователями и платежами.
- **dotenv**: Управление переменными окружения.
- **schedule**: Автоматизация периодических задач (например, напоминаний).

---

### Известные проблемы
1. Проверьте, чтобы все переменные окружения в `.env` были настроены корректно.
2. Будьте внимательны при миграциях базы данных, чтобы избежать несоответствий.

---

### Возможные улучшения
1. Добавить авторизацию администраторов через OAuth для веб-интерфейса.
2. Расширить список платежных систем за пределами YooKassa.
3. Реализовать полное покрытие проекта юнит-тестами.

---

### Лицензия
Проект распространяется под лицензией MIT.